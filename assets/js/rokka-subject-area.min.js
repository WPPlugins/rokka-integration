!function(e){var t=window.rokkaSubjectAreaEdit={iasapi:{},hold:{},postid:"",intval:function(e){return 0|e},round:function(e){var t;return e=Math.round(e),this.hold.sizer>.6?e:(t=e.toString().slice(-1),"1"===t?e-1:"9"===t?e+1:e)},validateNumeric:function(e){if(!this.intval(e))return!1},init:function(t){var a=this,i=a.intval(e("#subjectarea-original-width-"+t).val()),s=a.intval(e("#subjectarea-original-height-"+t).val());a.hold.w=a.hold.ow=i,a.hold.h=a.hold.oh=s,a.hold.xy_ratio=i/s,a.hold.sizer=parseFloat(e("#subjectarea-sizer-"+t).val()),a.postid=t;var l=e("#image-subjectarea-preview-"+t),n=e("#subjectarea-"+t);this.initSubjectArea(t,l,n),this.setNumSelection(t,e("#subjectarea-sel-x-"+t)),e(".subjectarea-wrap .imgedit-help-toggle").eq(0).focus()},initSubjectArea:function(a,i,s){var l,n=this,r=e("#subjectarea-sel-width-"+a),o=e("#subjectarea-sel-height-"+a),h=e("#subjectarea-sel-x-"+a),u=e("#subjectarea-sel-y-"+a);n.iasapi=e(i).imgAreaSelect({parent:s,instance:!0,handles:!0,keys:!0,minWidth:3,minHeight:3,onInit:function(t){l=e(t),l.next().css("position","absolute").nextAll(".imgareaselect-outer").css("position","absolute"),s.children().mousedown(function(e){var t,i,s=!1;e.shiftKey&&(t=n.iasapi.getSelection(),i=n.getSelRatio(a),s=t&&t.width&&t.height?t.width+":"+t.height:i),n.iasapi.setOptions({aspectRatio:s})})},onSelectChange:function(e,a){var i=t.hold.sizer;r.val(t.round(a.width/i)),o.val(t.round(a.height/i)),h.val(t.round(a.x1/i)),u.val(t.round(a.y1/i))}})},setNumSelection:function(t,a){var i,s,l,n,r=e("#subjectarea-sel-width-"+t),o=e("#subjectarea-sel-height-"+t),h=this.intval(r.val()),u=this.intval(o.val()),c=e("#subjectarea-sel-x-"+t),d=e("#subjectarea-sel-y-"+t),v=this.intval(c.val()),b=this.intval(d.val()),p=e("#image-subjectarea-preview-"+t),j=p.height(),g=p.width(),w=e("#subjectarea-info-"+t),f=this.hold.sizer,m=this.iasapi;if(w.text(""),(!1===this.validateNumeric(h)||h<3)&&(r.val(0),h=0),(!1===this.validateNumeric(u)||u<3)&&(o.val(0),u=0),(!1===this.validateNumeric(v)||v<0)&&(c.val(0),v=0),(!1===this.validateNumeric(b)||b<0)&&(d.val(0),b=0),h<3||u<3)return m.cancelSelection(),void m.update();i=Math.round(v*f),s=Math.round(b*f),l=i+Math.round(h*f),n=s+Math.round(u*f),l>g&&(i=0,l=g,r.val(Math.round(l/f)),c.val(0),w.text("Please reduce width to apply this X value.")),n>j&&(s=0,n=j,o.val(Math.round(n/f)),d.val(0),w.text("Please reduce height to apply this Y value.")),m.setSelection(i,s,l,n),m.setOptions({show:!0}),m.update()},removeSelection:function(t){var a=e("#subjectarea-sel-width-"+t),i=e("#subjectarea-sel-height-"+t),s=e("#subjectarea-sel-x-"+t),l=e("#subjectarea-sel-y-"+t),n=this.iasapi;a.val(0),i.val(0),s.val(0),l.val(0),n.cancelSelection(),n.update()}}}(jQuery);